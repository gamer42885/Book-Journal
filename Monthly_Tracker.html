<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic Monthly Book Tracker with Goals</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    transition: background 0.3s, color 0.3s;
}
.dark-mode { background-color: #121212; color: #f4f4f4; }

.topnav { background-color: #333; overflow: hidden; }
.topnav a {
    float: left;
    color: white;
    padding: 14px 16px;
    text-decoration: none;
}
.topnav a:hover { background-color: #04AA6D; }

.container { padding: 20px; }

form {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
}
.dark-mode form { background: #1e1e1e; }

input, select {
    margin: 5px 0;
    padding: 6px;
    width: 100%;
    max-width: 300px;
}

button {
    padding: 8px 12px;
    background: #04AA6D;
    color: white;
    border: none;
    cursor: pointer;
    margin-top: 10px;
}
button:hover { opacity: 0.9; }

table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    margin-top: 15px;
}
.dark-mode table { background: #1e1e1e; }

th, td {
    padding: 10px;
    border: 1px solid #ccc;
    text-align: left;
}

img { width: 80px; }

.progress-container {
    background: #ddd;
    border-radius: 20px;
    width: 100%;
    max-width: 400px;
    margin: 5px 0;
}
.progress-bar {
    height: 20px;
    border-radius: 20px;
    background: #04AA6D;
    width: 0%;
    text-align: center;
    color: white;
    font-size: 12px;
}

.star {
    font-size: 20px;
    cursor: pointer;
    color: gray;
}
.star.selected { color: gold; }

@media (max-width: 600px) {
    table, thead, tbody, th, td, tr { display: block; }
}
</style>
</head>

<body>

<!-- Navigation -->
<div class="topnav">
    <a href="index.html">Home</a>
    <a href="Book_Series.html">Book Series</a>
    <a href="Monthly_Tracker.html">Monthly Tracker</a>
    <a href="Yearly.html">Yearly Tracker</a>
    <a href="#" id="darkModeToggle">ðŸŒ™ Dark Mode</a>
</div>

<div class="container">

<h2>Dynamic Monthly Book Tracker</h2>

<!-- Month Selector -->
<label for="monthSelect">Select Month:</label>
<select id="monthSelect"></select>
<button id="addMonthBtn">+ Add Month</button>

<!-- Goals -->
<h3>Monthly Goals</h3>
<label>Goal: # of Books</label>
<input type="number" id="goalBooks" placeholder="e.g., 5">

<label>Goal: Pages</label>
<input type="number" id="goalPages" placeholder="e.g., 1500">

<button id="saveGoalsBtn">Save Goals</button>

<!-- Progress -->
<div>
    <p>Books Progress:</p>
    <div class="progress-container">
        <div id="booksProgress" class="progress-bar">0%</div>
    </div>

    <p>Pages Progress:</p>
    <div class="progress-container">
        <div id="pagesProgress" class="progress-bar">0%</div>
    </div>
</div>

<!-- Add Book -->
<h3>Add Book</h3>
<form id="bookForm">
    <label>Title:</label>
    <input type="text" id="title" required>

    <label>Author:</label>
    <input type="text" id="author">

    <label>Published:</label>
    <input type="text" id="published">

    <label># of Pages:</label>
    <input type="number" id="pages">

    <label>Date Started:</label>
    <input type="date" id="dateStarted">

    <label>Date Ended:</label>
    <input type="date" id="dateEnded">

    <label>Format:</label>
    <select id="format">
        <option>Book</option>
        <option>Ebook</option>
        <option>Audio</option>
    </select>

    <label>Genres (comma separated):</label>
    <input type="text" id="tags">

    <label>Rating:</label>
    <div id="starRating">
        <span class="star" data-value="1">â˜…</span>
        <span class="star" data-value="2">â˜…</span>
        <span class="star" data-value="3">â˜…</span>
        <span class="star" data-value="4">â˜…</span>
        <span class="star" data-value="5">â˜…</span>
    </div>

    <label>Book Cover:</label>
    <input type="file" id="cover" accept="image/*">

    <button type="submit">Add Book</button>
</form>

<!-- Stats -->
<h3>Reading Stats for Selected Month</h3>
<div id="stats"></div>

<!-- Book Table -->
<h3>My Books</h3>
<button id="exportPdfBtn">Export to PDF</button>

<table id="bookTable">
    <thead>
        <tr>
            <th>Title</th>
            <th>Cover</th>
            <th>Details</th>
            <th>Rating</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

</div>

<script>
// -------------------- Dark Mode --------------------
document.getElementById('darkModeToggle').addEventListener('click', ()=>{
  document.body.classList.toggle('dark-mode');
});

// -------------------- Star Rating --------------------
let rating = 0;
document.querySelectorAll(".star").forEach((star,index,stars)=>{
  star.addEventListener("click",()=>{
    rating=star.dataset.value;
    stars.forEach(s=>s.classList.remove("selected"));
    for(let i=0;i<rating;i++){stars[i].classList.add("selected");}
  });
});

// -------------------- Initialize Months --------------------
const currentDate = new Date();
const currentMonthValue = currentDate.toISOString().slice(0,7); // YYYY-MM
const currentMonthLabel = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' });

if(!localStorage.getItem("months")){
  localStorage.setItem("months",JSON.stringify([{label: currentMonthLabel, value: currentMonthValue}]));
}

function loadMonths(){
  const monthSelect = document.getElementById("monthSelect");
  monthSelect.innerHTML = "";
  let months = JSON.parse(localStorage.getItem("months")) || [];

  // Add current month if missing
  if(!months.find(m=>m.value===currentMonthValue)){
    months.push({label:currentMonthLabel, value:currentMonthValue});
    localStorage.setItem("months",JSON.stringify(months));
  }

  months.sort((a,b)=>a.value.localeCompare(b.value));
  months.forEach(m=>{
    const option=document.createElement("option");
    option.value=m.value;
    option.textContent=m.label;
    monthSelect.appendChild(option);
  });

  monthSelect.value = currentMonthValue;
}

// -------------------- Add Month --------------------
document.getElementById("addMonthBtn").addEventListener("click", ()=>{
  let label = prompt("Enter month name (e.g., March 2026):"); if(!label) return;
  let value = prompt("Enter month value YYYY-MM (e.g., 2026-03):"); if(!value) return;
  let months = JSON.parse(localStorage.getItem("months")) || [];
  months.push({label,label,value:value});
  localStorage.setItem("months",JSON.stringify(months));
  loadMonths();
  updateGoalsAndDisplay();
});

// -------------------- Save Goals --------------------
document.getElementById("saveGoalsBtn").addEventListener("click", ()=>{
  const month = document.getElementById("monthSelect").value;
  let goals = JSON.parse(localStorage.getItem("goals"))||{};
  goals[month] = {
    books: Number(document.getElementById("goalBooks").value)||0,
    pages: Number(document.getElementById("goalPages").value)||0
  };
  localStorage.setItem("goals",JSON.stringify(goals));
  updateProgress();
});

// -------------------- Add Book --------------------
const form = document.getElementById("bookForm");
form.addEventListener("submit", function(e){
  e.preventDefault();
  const month = document.getElementById("monthSelect").value;
  const book = {
    title:title.value, author:author.value, published:published.value,
    pages:Number(pages.value), started:dateStarted.value, ended:dateEnded.value,
    format:format.value, tags:tags.value, rating:rating, cover:"", month:month
  };
  const file = cover.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = ()=>{ book.cover = reader.result; saveBook(book); };
    reader.readAsDataURL(file);
  } else { saveBook(book); }
});

function saveBook(book){
  let books = JSON.parse(localStorage.getItem("books"))||[];
  books.push(book);
  localStorage.setItem("books",JSON.stringify(books));
  displayBooks();
  form.reset();
  rating = 0;
  document.querySelectorAll(".star").forEach(s=>s.classList.remove("selected"));
}

// -------------------- Display Books --------------------
function displayBooks(){
  const month = document.getElementById("monthSelect").value;
  const tbody=document.querySelector("#bookTable tbody");
  tbody.innerHTML="";
  let books = JSON.parse(localStorage.getItem("books"))||[];
  let filtered = books.filter(b=>b.month===month);
  filtered.forEach((book,index)=>{
    const row = tbody.insertRow();
    row.insertCell(0).textContent = book.title;
    const imgCell = row.insertCell(1);
    if(book.cover){ const img = document.createElement("img"); img.src = book.cover; imgCell.appendChild(img);}
    row.insertCell(2).innerHTML =
      `Author: ${book.author}<br>Published: ${book.published}<br>Pages: ${book.pages}<br>Started: ${book.started}<br>Ended: ${book.ended}<br>Format: ${book.format}<br>Genres: ${book.tags}`;
    row.insertCell(3).textContent = "â˜…".repeat(book.rating);
    const delCell = row.insertCell(4);
    const delBtn = document.createElement("button"); delBtn.textContent="X";
    delBtn.onclick = ()=>{ books.splice(books.indexOf(filtered[index]),1); localStorage.setItem("books",JSON.stringify(books)); displayBooks();};
    delCell.appendChild(delBtn);
  });
  updateProgress();
  calculateStats();
}

// -------------------- Update Progress Bars --------------------
function updateProgress(){
  const month = document.getElementById("monthSelect").value;
  const books = JSON.parse(localStorage.getItem("books"))||[];
  const filtered = books.filter(b=>b.month===month);
  const goals = JSON.parse(localStorage.getItem("goals"))||{};
  const goalBooks = goals[month]?.books||0;
  const goalPages = goals[month]?.pages||0;
  const totalBooks = filtered.length;
  const totalPages = filtered.reduce((sum,b)=>sum+b.pages,0);
  const booksPct = goalBooks?Math.min(100,Math.round(totalBooks/goalBooks*100)):0;
  const pagesPct = goalPages?Math.min(100,Math.round(totalPages/goalPages*100)):0;
  document.getElementById("booksProgress").style.width = booksPct+"%";
  document.getElementById("booksProgress").textContent = booksPct+"%";
  document.getElementById("pagesProgress").style.width = pagesPct+"%";
  document.getElementById("pagesProgress").textContent = pagesPct+"%";
}

// -------------------- Display Stats --------------------
function calculateStats(){
  const month = document.getElementById("monthSelect").value;
  const books = JSON.parse(localStorage.getItem("books"))||[];
  const filtered = books.filter(b=>b.month===month);
  let totalPages = filtered.reduce((sum,b)=>sum+Number(b.pages||0),0);
  let inProgress = filtered.filter(b=>b.started && !b.ended).length;
  let finished = filtered.filter(b=>b.ended).length;
  let avgRating = filtered.length? (filtered.reduce((sum,b)=>sum+Number(b.rating||0),0)/filtered.length).toFixed(2):0;
  document.getElementById("stats").innerHTML =
    `Total Books: ${filtered.length} | Finished: ${finished} | In Progress: ${inProgress} | Total Pages: ${totalPages} | Avg Rating: ${avgRating}`;
}

// -------------------- Update goals input & display on month change --------------------
function updateGoalsAndDisplay(){
  const month = document.getElementById("monthSelect").value;
  const goals = JSON.parse(localStorage.getItem("goals"))||{};
  document.getElementById("goalBooks").value = goals[month]?.books||"";
  document.getElementById("goalPages").value = goals[month]?.pages||"";
  displayBooks();
}

document.getElementById("monthSelect").addEventListener("change", updateGoalsAndDisplay);

// Initial load
loadMonths();
updateGoalsAndDisplay();
</script>

</body>
</html>